<?xml version="1.0" encoding="UTF-8"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="avatar">
 
    <xacro:arg name="prefix" default="" />
	
    <xacro:property name="avatar_prefix"
                    value="$(arg prefix)"/>

    <xacro:property name="mesh_folder"
                    value="package://iai_avatar_description/avatars/MetaHuman/meshes/fbx"/>

    <xacro:macro name="default_inertial" params="mass">
        <inertial>
            <mass value="${mass}"/>
            <inertia ixx="0.4" ixy="0.0" ixz="0.0" iyy="0.4" iyz="0.0" izz="0.2"/>
        </inertial>
    </xacro:macro>

    <xacro:macro name="mesh_coll" params="bpart">
        <visual>
            <geometry>
                <mesh filename="${mesh_folder}/${bpart}.fbx"/>
            </geometry>
        </visual>
        <collision>
            <geometry>
                <mesh filename="${mesh_folder}/${bpart}.fbx"/>
            </geometry>
        </collision>
    </xacro:macro>


    <xacro:macro name="yaw_pitch_joints" params="linkname mass">
        <link name="${avatar_prefix}${linkname}_yaw">
            <xacro:default_inertial mass="${mass}"/>
        </link>

        <link name="${avatar_prefix}${linkname}_pitch">
            <xacro:default_inertial mass="${mass}"/>
        </link>
    </xacro:macro>

    <link name="${avatar_prefix}root"/>

    <link name="${avatar_prefix}pelvis">
        <xacro:mesh_coll bpart="pelvis"/>
        <xacro:default_inertial mass="8.36"/>
    </link>

    <xacro:yaw_pitch_joints linkname="pelvis" mass="8.36"/>

    <link name="${avatar_prefix}spine_04">
        <xacro:mesh_coll bpart="torso"/>
        <xacro:default_inertial mass="5.43"/>
    </link>

    <xacro:yaw_pitch_joints linkname="spine_04" mass="5.43"/>

    <link name="${avatar_prefix}head">
        <xacro:mesh_coll bpart="head"/>
        <xacro:default_inertial mass="3.34"/>
    </link>

    <xacro:yaw_pitch_joints linkname="head" mass="3.34"/>

    <link name="${avatar_prefix}clavicle_l">
        <xacro:default_inertial mass="2.08"/>
    </link>

    <link name="${avatar_prefix}upperarm_l">
        <xacro:mesh_coll bpart="upperarm_l"/>
        <xacro:default_inertial mass="1.75"/>
    </link>

    <xacro:yaw_pitch_joints linkname="upperarm_l" mass="1.75"/>

    <link name="${avatar_prefix}lowerarm_l">
        <xacro:mesh_coll bpart="lowerarm_l"/>
        <xacro:default_inertial mass="1.39"/>
    </link>

    <xacro:yaw_pitch_joints linkname="lowerarm_l" mass="1.39"/>

    <link name="${avatar_prefix}hand_l">
        <xacro:mesh_coll bpart="hand_l"/>
        <xacro:default_inertial mass="1.56"/>
    </link>

    <xacro:yaw_pitch_joints linkname="hand_l" mass="1.56"/>
    

                                <!-- Joints -->
    <joint name="${avatar_prefix}root_to_${avatar_prefix}pelvis_yaw" type="fixed">
        <parent link="${avatar_prefix}root"/>
        <child link="${avatar_prefix}pelvis_yaw"/>
        <origin rpy="1.5708 -1.5708 0" xyz="0 0 0.8854"/>
    </joint>
    
    <joint name="${avatar_prefix}pelvis_yaw_to_${avatar_prefix}pelvis_pitch" type="revolute">
        <parent link="${avatar_prefix}pelvis_yaw"/>
        <child link="${avatar_prefix}pelvis_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}pelvis_pitch_to_${avatar_prefix}pelvis" type="revolute">
        <parent link="${avatar_prefix}pelvis_pitch"/>
        <child link="${avatar_prefix}pelvis"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="1 0 0"/>
    </joint>

    <joint name="${avatar_prefix}pelvis_to_${avatar_prefix}spine_04_yaw" type="revolute">
        <parent link="${avatar_prefix}pelvis"/>
        <child link="${avatar_prefix}spine_04_yaw"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0.2070 0 0"/>
        <axis xyz="1 0 0"/>
    </joint>
    
    <joint name="${avatar_prefix}spine_04_yaw_to_${avatar_prefix}spine_04_pitch" type="revolute">
        <parent link="${avatar_prefix}spine_04_yaw"/>
        <child link="${avatar_prefix}spine_04_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}spine_04_pitch_to_${avatar_prefix}spine_04" type="revolute">
        <parent link="${avatar_prefix}spine_04_pitch"/>
        <child link="${avatar_prefix}spine_04"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 0 1"/>
    </joint>

    <joint name="${avatar_prefix}spine_04_to_${avatar_prefix}head_yaw" type="revolute">
        <parent link="${avatar_prefix}spine_04"/>
        <child link="${avatar_prefix}head_yaw"/>
        <dynamics damping="1.0" friction="0.0001"/>
        <origin rpy="0 0 0" xyz="0.351 0 0"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="1 0 0"/>
    </joint>

    <joint name="${avatar_prefix}head_yaw_to_${avatar_prefix}head_pitch" type="revolute">
        <parent link="${avatar_prefix}head_yaw"/>
        <child link="${avatar_prefix}head_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}head_pitch_to_${avatar_prefix}head" type="revolute">
        <parent link="${avatar_prefix}head_pitch"/>
        <child link="${avatar_prefix}head"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 0 1"/>
    </joint>
    
    <joint name="${avatar_prefix}spine_04_to_${avatar_prefix}clavicle_l" type="revolute">
        <parent link="${avatar_prefix}spine_04"/>
        <child link="${avatar_prefix}clavicle_l"/>
        <origin rpy="0 1.5708 0" xyz="0.155142808 0.00883206 -0.00816548"/>
        <dynamics damping="1.0" friction="0.0001"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="0 1 0"/>
    </joint>
    
    <joint name="${avatar_prefix}clavicle_l_to_${avatar_prefix}upperarm_l_yaw" type="revolute">
        <parent link="${avatar_prefix}clavicle_l"/>
        <child link="${avatar_prefix}upperarm_l_yaw"/>
        <dynamics damping="1.0" friction="0.0001"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 1.0471975511965976 0" xyz="0.13340044 0 0"/>
        <axis xyz="0 0 1"/>
    </joint>

    <joint name="${avatar_prefix}upperarm_l_yaw_to_${avatar_prefix}upperarm_l_pitch" type="revolute">
        <parent link="${avatar_prefix}upperarm_l_yaw"/>
        <child link="${avatar_prefix}upperarm_l_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}upperarm_l_pitch_to_${avatar_prefix}upperarm_l" type="revolute">
        <parent link="${avatar_prefix}upperarm_l_pitch"/>
        <child link="${avatar_prefix}upperarm_l"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="1 0 0"/>
    </joint>
    
    <joint name="${avatar_prefix}upperarm_l_to_${avatar_prefix}lowerarm_l_yaw" type="revolute">
        <parent link="${avatar_prefix}upperarm_l"/>
        <child link="${avatar_prefix}lowerarm_l_yaw"/>
        <origin rpy="0 0 0" xyz="0.238537997 0 0"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <axis xyz="1 0 0"/>
    </joint>

    <joint name="${avatar_prefix}lowerarm_l_yaw_to_${avatar_prefix}lowerarm_l_pitch" type="revolute">
        <parent link="${avatar_prefix}lowerarm_l_yaw"/>
        <child link="${avatar_prefix}lowerarm_l_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}lowerarm_l_pitch_to_${avatar_prefix}lowerarm_l" type="revolute">
        <parent link="${avatar_prefix}lowerarm_l_pitch"/>
        <child link="${avatar_prefix}lowerarm_l"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="1 0 0"/>
    </joint>

    <joint name="${avatar_prefix}lowerarm_l_to_${avatar_prefix}hand_l_yaw" type="revolute">
        <parent link="${avatar_prefix}lowerarm_l"/>
        <child link="${avatar_prefix}hand_l_yaw"/>
        <dynamics damping="1.0" friction="0.0001"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="-1.2351 0.1883 -0.2033" xyz="0.22966 0 -0.0000001"/>
        <axis xyz="1 0 0"/>
    </joint>

    <joint name="${avatar_prefix}hand_l_yaw_to_${avatar_prefix}hand_l_pitch" type="revolute">
        <parent link="${avatar_prefix}hand_l_yaw"/>
        <child link="${avatar_prefix}hand_l_pitch"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="0 1 0"/>
    </joint>

    <joint name="${avatar_prefix}hand_l_pitch_to_${avatar_prefix}hand_l" type="revolute">
        <parent link="${avatar_prefix}hand_l_pitch"/>
        <child link="${avatar_prefix}hand_l"/>
        <limit effort="1" lower="-1.5708" upper="2.44346" velocity="1"/>
        <origin rpy="0 0 0" xyz="0 0 0"/>
        <axis xyz="1 0 0"/>
    </joint>

</robot>
